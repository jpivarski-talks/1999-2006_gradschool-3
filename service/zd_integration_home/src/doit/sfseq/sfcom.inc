*
* $Id: sfcom.inc,v 1.14 2003/03/05 18:37:17 dpp Exp $
*
* $Log: sfcom.inc,v $
* Revision 1.14  2003/03/05 18:37:17  dpp
*      -> add definition of the z slice
*      -> add control of TPC specific code
*      -> add arrays for intermediate chain storage for z slices
*      -> remove special (faster?) reset for sfbwal
*      -> move control of z windo center, size and loop to sfcuts.F
*      -> remove (null) cuts on number of hits in individual devices in SFNEXT
*
* Revision 1.13  2002/09/05 19:18:26  dpp
*      -> add ICHAIN to common
*
* Revision 1.12  2000/08/18 18:38:10  dpp
*      -> define cuts to remove Z test near top of curler
*
* Revision 1.11  2000/02/12 20:35:53  dpp
*      -> extend infor from velocity calculation
*
* Revision 1.10  2000/01/06 22:24:28  dpp
* > add switch to stop searching layer after finding
*  a wide hit in a stereo transition layer
*
* Revision 1.9  1999/12/09 21:04:09  dpp
* add ZNDSSF; length of layer in sf format, for z escape
* add constants to control test of Z escape to remove test of Z stragler
*
* Revision 1.8  1999/11/19 22:48:06  dpp
* time cuts that used to be in sfpar
* multiplier to make startup data run
*
* Revision 1.7  1999/10/12 15:12:27  dpp
* change dimension of THRS_USE_PNT to include 0
*
* Revision 1.6  1999/10/06 12:45:20  dpp
* new variables for width at stereo trans
*
* Revision 1.5  1999/08/11 17:37:49  dpp
* added spare location indexed by hit
*
* Revision 1.4  1999/08/03 22:02:23  dpp
* cuts on z consistancy
*
* Revision 1.3  1999/04/27 19:53:32  dpp
* single hits; z mesurements; used hit, velocity change in extension;
* miss in SFMERG
*
* Revision 1.2  1999/01/29 15:08:26  dpp
* cuts for SFCHAN for stereo transitions
*
* Revision 1.1.1.1  1998/02/06 19:11:50  dpp
* DOIT first release.
*
* Revision 1.1.1.1  1997/04/30 12:31:41  clib
* Developmental version of DUET.
*
* Revision 1.6  1997/02/25 22:00:36  dpp
* add variables for chain finding in SVX and cloning
*
* Revision 1.5  1996/04/15 17:15:39  dpp
* moved some velocity calculation constants from parameters to common
*
* Revision 1.4  1996/03/20 17:07:15  zfiles
* add array of zeroing list for SFIND
*
* Revision 1.3  1996/02/14 21:17:58  zfiles
* add SFLSFA,SFWSFA to sfcom.inc,  move SFLACD from sfxtsc.inc to sfcom.inc
*
* Revision 1.2  1995/04/20 22:29:02  zfiles
* Dan's change. See TITLE.doit
*
* Revision 1.1.1.1  1994/10/08  01:01:12  zfiles
* first version of doit in CVS
*
*
*CMZ :  6.00/25 10/05/94  17.09.32  by  Anders Ryd
*CMZ :  6.00/14 01/03/94  17.25.32  by  Rob Kutschke
*CMZ :          30/03/93  13.10.25  by  Dan Peterson
* ------------------------------------------
* COMMON BLOCKS FOR SF ROUTINES INCLUDING SFHITS
*
* sfcom.inc
*
#if !defined(CLEO_NOCOMDOC)
* SFCOM DOCUMENTATION

C...... STEP FIND COMMON BLOCK DOCUMENTATION

C /SFCM0I/..........CONTROL
C CNTLSF......CONTROL_SFIND  1 : REGULAR CHAIN FINDING
C                            2 : NO 2ND CALL TO SFCHAN, NO SFMERG
C                            5 : SFBWAL CHANGES TO DATA ACCESS
C CNTLMG......CONTROL_SFMERG 1 : FILL NEW TRACKS WITH MERG USING PRIORITY
C                            2 : FILL MERG LIST WITH ALL POSSIBLE MERGES
C FRSTST......FIRST STARTING LAYER FOR CHAIN SEARCH;SFCHAIN
C LASTST......LAST STARTING LAYER FOR CHAIN SEARCH;SFCHAIN
C LASTFN......LAST  HIT FINDING LAYER FOR CHAIN SEARCH;SFCHAIN
C MXLSFU......MAXIMUM STARTING LAYER NUMBER IN SFNEXT FOR USABLE CHAIN
C MNLBSF......MINIMUM LAYERS BACK FROM MLASSF FOR SFIND TO INITIATE CHAIN
C CHNEXT......DIRECTION OF CHAIN EXTEND USING SFCHAN IN SFIND, 2 PASSES
C             ( 2 LOOPS) 1, OUTWARD, -1 INWARD, 0 SKIP
C SFZSLNWINDO.SF Z SLICE, number of dz windows, on each side
C SFZSLWINDOL.SF Z SLICE, windo number least, start of loop
C SFZSLWINDOM.SF Z SLICE, windo number maximum, end of loop


C /SFCM0L/..........CONTROL
C LALTRD......USE THE ALTERNATE READOUT ON DUAL READOUT LAYERS
C LCLNSF......CLONE THE SF CHAINS BEFORE THE EXTENSION LOOP (2 LOOPS)
C LSFSVF......CALL SFSVFM FROM SFIND
C L_SF_DOIT_TPC...use TPC specific code in SF, set from DOIT status bits

C /SFCM0R/..........CONTROL
C SFZSLMAXDZ..SF Z SLICE maximum , to define the granularity
C SFZSLGRANU..SF Z SLICE granularity, diff in center DZ, adjacent slices 
C SFZSLOVLAP..SF Z SLICE overlap, to define slice width
C SFZSLOVRAD..SF Z SLICE overlap radius, radius that has specified overlap
C SFZSLCNTR...SF Z SLICE CENTER, FOR LIMITING Z WHEN RUNNING SFCHAN
C SFZSLWID....SF Z SLICE WIDTH, FOR LIMITING Z WHEN RUNNING SFCHAN
C SFZSLVEL....SF Z SLICE VELOCITY; used to convert time into distance

C /SFCMCONFIG/...........CONFIGURATION DEPENDENT VARIABLES
C MLSFSV....MAXIMUM SF LAYER IN SVX
C MLSFPT....MAXIMUM SF LAYER IN PT
C MLSFVD....MAXIMUM SF LAYER IN VD
C MLSFVD....MAXIMUM SF LAYER IN ZD
C MLSFDR....MAXIMUM SF LAYER IN DR
C MLSSFSV...MAXIMUM SSF LAYER IN SVX
C MLSSFPT...MAXIMUM SSF LAYER IN PT
C MLSSFVD...MAXIMUM SSF LAYER IN VD
C MLSSFVD...MAXIMUM SSF LAYER IN ZD
C MLSSFDR...MAXIMUM SSF LAYER IN DR


C /SFCTL/......... SF CONTROL
C SFCTYP...FLAG; 1 FOR INITIAL SCAN, 2 TO EXTEND EXISTING CHAIN,
C IDIRSF...DIRECTION OF STEP
C CLIN.....ADDRESS CORRECTION FOR LINCHN
C CMIN.....ADDRESS CORRECTION FOR MINCHN
C CFOR.....ADDRESS CORRECTION FOR ISTFOR
C CBAK.....ADDRESS CORRECTION FOR ISTBAK
C ENDLO....INDEX FOR LOGICAL LOW END OF CHAIN
C ENDHI....INDEX FOR LOGICAL HIGH END OF CHAIN

C /SFCM1/..........CHAIN INFORMATION
C ICHAIN......CURRENT CHAIN NUMBER
C NCHAIN......NUMBER OF CHAINS FOUND
C LINCHN(I)...ADDRESS ,IN MAP, OF FIRST ELEMENT IN CHAIN #I
C MINCHN(I)...ADDRESS, IN MAP, OF LAST ELEMENT IN CHAIN #I
C LENCHN(I)...NUMBER OF ELEMENTS, IE LENGTH, OF CHAIN #I
C LVLCHN(J,I).VELOCITY, (START:J=1, END:J=2), OF CHAIN#I
C SNGCHN(I)...NUMBER OF SINGLE CELL ELEMENTS IN CHAIN

C /SFZCM1/........Z DEPENDENCE OF CHAIN INFORMATION
C ZR0CHN(I)...Z AR Z=0 OF CHAIN #I
C ZDRCHN(I)...DZ/DR OF CHAIN #I

C /SFCM2/..........HIT INFORMATION, ADDRESSED AS WIRE MAP
C ISTFOR(I)...ADDRESS OF HIT THAT IS 1 STEP FORWARD IN CHAIN
C ISTBAK(I)...ADDRESS OF HIT THAT IS 1 STEP BACKWARD IN CHAIN
C INUCHN(I)...GIVE THE CHAIN NUMBER THAT THIS HIT BELONGS
C          ...NEGATIVE NUMBERS ARE HIT QUALITY PROBLEMS
C DOUBPT(I)...POINTS TO DOUBLET HIT PARTNER
C SFSPAR(I)...SPARE LOCACATION, USED FOR ie VELOCITY
C INUEFF(I)...USED LIKE INUCHN FOR EFFICIENCY, NEG IS NON HIT
C          ...SWITCH ON ONLY FOR SFDIAG

C /SFCM3/..........GEOMETRY INFORMATION
C NLAYSF.......NUMBER OF SF LAYERS
C INSFSF(I)...FIRST SF CELL ADDRESS FOR SF LAYER
C INCDSF(I)...FIRST CD CELL ADDRESS FOR SF LAYER
C CDLASF(I)...CD LAYER FOR A GIVEN SF LAYER
C SFLACD(I)...SF LAYER FOR CD LAYER NUMBER
C SFLSFA(I)...SF LAYER FOR AN SF ADDRESS
C SFWSFA(I)...SF ADDRESS FOR AN SF ADDRESS
C OFFSF(I)....OFFSET (IN WIRES) FROM PHI=0, MULTIPLIED ,  SF LAYER
C RADSF(I)....RADIUS OF LAYER, CM, MULTIPLIED , SF LAYER
C NWRSF(I)....NUMBER OF WIRES IN AN SF LAYER
C OFFSSF(I)...OFFSET (IN WIRES) FROM PHI=0, MULTIPLIED ,  SSF LAYER
C RADSSF(I)...RADIUS OF LAYER, CM, MULTIPLIED , SSF LAYER
C NWRSSF(I)...NUMBER OF WIRES IN AN SSF LAYER
C RPWSSF(I)...RADIUS_PER_WIRE, SSF LAYER, SCALED

C /SFZCM3/.........ADDED GEOMETRY INFORMATION FOR SF WITH Z DEPENDENCE
C TANSSF(I)...TAN OF STEREO ANGLE, MULTUPLIED
C ZNDSSF(I)...Z END OF LAYER, SSF LAYER, METERS, SCALED

C /SFCM4/..........VELOCITY INFORMATION
C VSTORH........HALF OF THE TOTAL NUMBER OF HITS SAVED FOR VELOCITY
C VSTORS........THIS IS SUM OF 1+2+...+VSTORH
C VSTORF........FULL NUMBER OF HITS SAVED FOR VELOCITY CALCULATION
C ISTORV........NUMBER OF VELOCITY CALCULATIONS STORED, (FOUND HITS)
C VLLOC1........LOCATION IN CIRCULAR STORAGE OF LATEST DATA,
C...............OR, WHAT WILL BE LATEST AFTER PROCESSING THE VEL SECTION
C VLLOC2........LOCATION IN CIRCULAR STORAGE OF PREVIOUS LATEST DATA
C VLLOC3........LOCATION IN CIRCULAR STORAGE OF LATEST DATA IN PREVIOUS SET
C IVTEMP(I).....VELOCITY CALCULATIONS, VELOCITY, 1:LATTER, 2:FORMER
C EXTPV1...EXTRAPOLATED IVTEMP(1) TO PREDICTED VLPRLM
C EXTPV2...EXTRAPOLATED IVTEMP(2) TO PREDICTED VLPRLM
C EXTPDM...DENOMINATOR FOR EXTPV1,EXTPV2
C EXTUV1...EXTRAPOLATED IVTEMP(1) TO PREDICTED VLPRLM, USED
C EXTUV2...EXTRAPOLATED IVTEMP(2) TO PREDICTED VLPRLM, USED
C EXTUDM...DENOMINATOR FOR EXTUV1,EXTUV2,    USED
C EXTPRL...EXTRAPLOATED VLPRLM TO VLPRED
C EXTOLD...EXTRAPLOATED VLPOLD TO VLPRED
C EXTODM...DENOMINATOR FOR EXTPRL,EXTOLD
C RFX_N(K)......RADIUS,FI,EXTRA--NOW
C RFX_L(K)......RADIUS,FI,EXTRA--LAST
C RFX_S(K,L)....R,F,X STORED, FOR THE LAST FEW HITS, ISTORV DIRECTS ORDER
C               K index 4:5 for storing unsmoothed values
C RFX_SS(K,I)...R,F,X STORED AND SUMMED, FOR I=1:LATTER,2:FORMER
C VELADD(L).....ADDRESSES OF HITS USED IN VELOCITY, CIRCULAR LIKE RSX_S

C /SFZCM4/.........Z FINDING INFORMATION
C ZNCHN(I)....NUMBER OF MEASUREMENTS USED IN THE CALCULATION, I=CHAIN NUMBER
C SFZMS1(I)...SUM OF Z CALCULATION WEIGHTS
C SFZMS2(I)...SUM OF WEIGHTED Z VALUES
C SFZMR(J,I)..RADIUS OF THE Z MEASUREMENT,   J=MEASURMENT; I=CHAIN NUMBER
C SFZMZ(J,I)..Z OF THE Z MEASUREMENT
C SFZMD(J,I)..DIFFERENCE IN TANDSF USED TO MAKE Z MEASUREMENT
C SFZML(J,I)..LAYER NUMBER WHERE Z MEASUREMENT IS MADE
C /SFZCM5/.........more Z FINDING INFORMATION
C ZMESPT(I)...POINTER FROM SF CELL NUMBER TO Z MEASUREMENT
C PTZMES(J,I)...POINTER FROM  Z MEASUREMENT to SF CELL NUMBER 

C /SFCM5/..........SUCCESS OF CHAIN HISTORY
C ILTRY.......NUMBER OF LAYERS TRIED
C NUTSTD......NUMBER OF THE MUTSTC POSSIBLE TESTS DEFINED
C NUTSTP......NUMBER OF THE TESTS CHECKED TO PASS TO NEXT LAYER
C JUTSTC......TEST NUMBER THAT IS REQUIRED FOR LAST HIT IN CHAIN
C IUCNTR(I)...COUNTERS FOR TWO SUCCESS CRITERIA
C LTOPAS(I,J).NUMBER THAT IS NEEDED TO PASS THE TEST,2ND INDEX IS TYPE
C LOUTOF(I,J).NUMBER OF LAYERS -OUT-OF- WHICH THE TEST IS MADE
C IUSAV(J)....STORED HISTORY OF FINDS FOR LAST FEW HITS, ILTRY ORDER

C /SFCM6/..........IEXTRA CHAIN INFORMATION, ADDRESSING
C ICHAN1...ADDRESS OF FIRST CHAIN TO TEST
C NXTCHN...ADDRESS OF NEXT CHAIN TO TEST
C KILCHN...LIST OF CHAINS TO KILL IF A TRACK IS FOUND WITH PRESENT CHAIN
C ICHANU.......=0  CHAIN IS BAD OR TRIED, DO NOT USE IN ANY WAY
            ...=1  CHAIN IS MARGINAL, CAN BE USED AS A PART OF A MERGE
            ...=2  CHAIN IS USABLE, BUT CAN NOT BE MERGED AGAIN
            ...=3  CHAIN IS USABLE, CAN BE MERGED TO THE LOW END
            ...=4  CHAIN IS USABLE, CAN BE MERGED TO THE HIGH END
            ...=5  CHAIN IS USABLE AND COMPLETELY MERGEABLE
            ...CLASSES 3 AND 4 NOT IMPLEMENTED, NOW CALLED =2
C HTUCHN...INUCHN VALUE FOR HITS ON THIS CHAIN
C CLNCHN...CLONE GROUP FOR CHAINS


C /SFCM7/..........TO PASS INFORMATION TO VDFPIE
C NCHANM...NUMBER OF CHAINS BEING PASSED
C JCHAIN...LIST OF CHAINS BEING PASSED

C /SFCM8/..........ADDRESSING OF THE SUPER SF LAYERS
C NLASSF...NUMBER OF SSF LAYERS
C LAYSSF...SSF LAYER NUMBER FOR EACH SF LAYER, FILLED IN SFINIT
C LAYSF....SF LAYER NUMBERS FOR EACH SSF LAYER, LIMITED STORAGE
C MAPSSF...MAP FROM SSF WIRE ADRESS TO SF WIRE ADDRESS
C WIRSSF...MAP FROM SF WIRE ADDRESS TO WIRE NUMBER IN SSF LAYER
C LADSSF...ADDRESS, IN MAPSSF, OF FIRST WIRE IN SSF LAYER
C MADSSF...ADDRESS, IN MAPSSF, OF LAST WIRE IN SSF LAYER

C /SFCM9/...........CUTS
C NEDCLR...NUMBER OF WIRES "NEEDED CLEAR" FOR ISOLATED HIT
C AJUSOK...ADJACENT WIRE IS ALREADY USED, OK TO CALLED IT CLEAR
C AFT_USED_OK....CONTINUE SEARCHING LAYER AFTER FINDING USED HIT; OK
C AFT_N_ISO_S_OK.CONTINUE SEARCHING LAYER AFTER FINDING NON-ISOLATED HIT
C                IN STEREO TRANSITION LAYER; OK
C MINLCH...MININUM NUMBER OF HITS IN A CHAIN
C WIDAD0...ADDED SEARCH WIDTH WHEN THERE ARE MANY RECENT FOUND LAYERS
C WIDAD1...ADDED SEARCH WIDTH WHEN THERE ARE MINIMAL RECENT FOUND LAYERS
C WIDAD2...ADDED SEARCH WIDTH WHEN THERE IS A GAP IN FOUND LAYERS
C LENCA1...LENGTH OF NEW CHAIN TO SWITCH FROM A2 TO A1
C LENCA0...LENGTH OF NEW CHAIN TO SWITCH FROM A1 TO A0
C GAPWD1...SIZE OF GAP TO CONVERT TO WIDA11
C GAPWD2...SIZE OF GAP TO CONVERT TO WIDA21
C MDOUBH...MAXIMUM NUMBER OF DOUBLE HITS IN A ROW
C MNOTIS...MAXIMUM NUMBER OF UNISOLATED HITS IN A ROW ALLOWED
C......TEST IF RPWSSF(ILYRT) < XXRPWL/XXRPWN *RPWSSF(ILYRL)
C XXRPWL...MULTIPLYER FOR RPWSSF(ILYRL)
C XXRPWN...MULT FOR RPWSSF(ILYRT)
C........
C cuts for extra width for stereo change and scaling of the stereo shift
C N_ST_THR_DEF...NUMBER OF STEREO THRESHOLDS DEFINED
C THRS_USE_PNT...THRESHOLD TO USE FOR NUMBER OF FOUND STEREO MEASUREMENTS
C THRS_ST_MEAS...THRESHOLD IN NUMBER OF STEREO MEASUREMENTS
C WID_AD_ST......WIDTH ADDED AT STEREO TRANSION AS NUMBER OF 16TH
C                OF THE MAXIMUM WIRE CROSSING (*2 FOR EITHER SIDE)
C WID_AD_ST_LM...WIDTH ADDED AT STEREO TRANSIONS; LIMIT 
C SCAL_ST_SHFT...SCALING OF THE "FULL" STEREO SHIFT TO THE "USED"
C                AS NUMBER OF 16TH OF THE FULL SHIFT
C......
C CCTRLO.........CELL CENTER LO, TEST IF LO ENOUGH IN PREDICTED CELL
C CCTRHI.........CELL CENTER LO, TEST IF HI ENOUGH IN PREDICTED CELL
C WSVADD.........WIRE SHIFT FROM VELOCITY ADD, ADD TO DIRECTION OF VELOCITY
C GAPFIM.........MAXIMUM GAP IN PHI BEFORE DENOTING AS STRAGLER
C V_CHANGE_LIM...LIMIT CHANGE IN VELOCITY (LOW END)  FOR SECOND PASS
C ZTST_RMV_OUTER.REMOVE Z TEST WHEN CHAIN EXTENDS CLOSE TO CHAMB OUTER RADIUS
C ZTST_RMV_INNER.REMOVE Z TEST WHEN CHAIN EXTENDS CLOSE TO CHAMB INNER RADIUS
C ZTST_RMV_IN_AX.REMOVE Z TEST WHEN CHAIN EXTENDS INTO INNER AXIAL LAYERS
C ZTST_SEL_IN_AX.SELECT TRIAL LAYERS WHEN CHAIN EXTENDS INTO INNER AXIAL LAYERS
C ZTST_SEL_VALID.SELECT TRIAL LAYERS WHEN VALIDATED BY ADITIONAL LAYERS
C ZTST_ESC_ZWIND.REMOVE Z TEST WHEN CHAIN IS WITHIN WINDOW OF ENDPLATE
C ZTST_ESC_CURLV.REMOVE Z TEST AT TOP OF CURLER; VELOCITY IS ABOVE MIN
C ZTST_ESC_LEN_C.REQUIRED CHAIN LENGTH TO TEST FOR VELOCITY AT TOP OF CURLER
C ZTST_ESC_MM0...MINIMUM Z MEASUREMENTS (WITHOUT TEST OF LN_SINCE_Z_CHANGE)
C                TO TEST Z ESCAPE
C ZTST_ESC_MMWL..MINIMUM Z MEASUREMENTS (WITH TEST OF LN_SINCE_Z_CHANGE)
C                TO TEST Z ESCAPE
C ZTST_ESC_MLS...MINIMUM LN_SINCE_Z_CHANGE WHEN USING ZTST_ESC_MMWL 
C RAW_TDC_L......LOW END CUT ON RAW TDC IN COUNTS
C RAW_TDC_H......HIGH END CUT ON RAW TDC IN COUNTS
C TIME_PS_L......LOW END CUT ON TIME IN PS
C TIME_PS_H......HIGH END CUT ON TIME IN PS
C DRIFT_EXTRA_LO.EXTRA DRIFT DISTANCE TO BUILD CUT ON LOW SIDE IN MICRONS
C DRIFT_EXTRA_HI.EXTRA DRIFT DISTANCE TO BUILD CUT ON HIGH SIDE IN MICRONS
C DRIFT_D_L......LOW END CUT ON DRIFT DISTANCE, IN MICRONS
C DRIFT_D_H......HIGH END CUT ON DRIFT DISTANCE, IN MICRONS
C PULS_HT_L......LOW END CUT ON PULSE HEIGHT
C PULS_HT_H......HIGH END CUT ON PULSE HEIGHT



C THESE COMMOM BLOCK FOR SF EXTENDED

C /SFECM1/...........LIST OF MERGES
C NMERG....NUMBER OF MERGES
C NXTMRG...ORDER OF MERGES BY QUALITY
C I12SAV...MAJOR AND MINOR CHAIN NUMBER OF THE SIMPLE MERGE
C UZSAV....=1 IF MAJOR/MINOR CHAIN Z INFO IS USED 
C DIFAMG...MATCH DIFFERENCE IN CELLS*MULST
C DIFALT...MATCH DIFFERENCE IN CELLS*MULST, ALTERNATE DIRECTION
C VDIFSV...VELOCITY DIFFERNCE
C END2S....END OF THE MAJOR CHAIN THAT POINTS TO MINOR, 1:MAJOR IS OUTER
C DELMHT...DELETE MERGE HIT (OFF OF MINOR CHAIN)

C /SFECM2/...........LIST OF SUPER CHAINS
C NSUPCH...NUMBER OF SUPER CHAINS
C NSUPCE...NUMBER OF SUPER CHAIN SIMPLE ELEMENTS
C SUPCAD...ADDRESS OF FIRST SIMPLE ELEMENT OF THIS SUPER CHAIN
C SUPCLN...LENGTH (NUMBER OF SIMPLE ELEMENTS) OF SUPER CHAIN
C SUPCUS...USE CODE FOR SUPER CHAINS
C SUPCEL...SUPER CHAIN SIMPLE ELEMENTS

C /SFDIAGSTOP/.......diagnostic stops
C SFIND_ANALYZ....analyze event
C SFIND_ACKMERG...acknowledge stop before calling merge
C SFIND_ASFEFF....always use SFEFF
C DSFHIT_KILLA....request for dump of hit information after SFCHAN
C DSFRFV_KILALL...control of displaying all, or no display
C DSFRFV_KILL2....control of the stop before the secondary operations
C SFMERG_KILLA1...flag to stop waiting for acceptance for single merge
C SFMERG_KILLA2...flag to stop waiting for acceptance for multiple merge
C SFMERG_KILLA3...flag to stop waiting for acceptance for merge test
C DSFCHV1_KILLA...flag for acknowledge chain

C /SFCCHANLIST/....intermediate listing of chains
C SFChanList_Num.....number of chains in buffer
C SFChanList_LastLoc.last used location in SFChanList_SFid 
C SFChanList_Iwindo..window numberm used to restore z limits
C SFChanList_1stLoc..location in buffer of first element
C SFChanList_Length..length of chain in buffer
C SFChanList_ChnUse..use code, copy of ICHANU
C SFChanList_KilChn..kill list, copy of KILCHN
C SFChanList_SFid....SF cell id, negative if this is a double hit
#endif

      INTEGER CNTLSF,CNTLMG,FRSTST,LASTST,LASTFN
      INTEGER MXLSFU,MNLBSF,CHNEXT
      INTEGER SFZSLNWINDO,SFZSLWINDOL,SFZSLWINDOM
      LOGICAL LALTRD,LCLNSF,LSFSVF
      LOGICAL L_SF_DOIT_TPC
      REAL    SFZSLMAXDZ,SFZSLGRANU,SFZSLOVLAP,SFZSLOVRAD
      REAL    SFZSLCNTR, SFZSLWID, SFZSLVEL
      INTEGER MLSFSV, MLSFPT, MLSFVD, MLSFZD, MLSFDR
      INTEGER MLSSFSV,MLSSFPT,MLSSFVD,MLSSFZD,MLSSFDR

      INTEGER ZR0CHN,ZDRCHN
      INTEGER ISTFOR,ISTBAK,INUCHN,DOUBPT,SFSPAR
      INTEGER ICHAIN,NCHAIN,LINCHN,MINCHN,LENCHN,LVLCHN,SNGCHN

#if defined(CLEO_SFDIAG)
      INTEGER INUEFF
#endif

      INTEGER NLAYSF
      INTEGER INSFSF,INCDSF,CDLASF,SFLACD,SFLSFA,SFWSFA
      INTEGER  OFFSF, RADSF,NWRSF ,OFFSSF,RADSSF,NWRSSF,RPWSSF
      INTEGER TANSSF,ZNDSSF
      INTEGER VSTORH,VSTORS,VSTORF,ISTORV,VLLOC1,VLLOC2,VLLOC3
      INTEGER IVTEMP
      INTEGER EXTPV1,EXTPV2,EXTPDM,EXTUV1,EXTUV2,EXTUDM
      INTEGER EXTPRL,EXTOLD,EXTODM
      INTEGER RFX_N ,RFX_L ,RFX_S, RFX_SS,VELADD
      INTEGER ZNCHN, SFZMS1,SFZMS2, SFZMR, SFZMZ, SFZMD, SFZML
      INTEGER ZMESPT,PTZMES
      INTEGER ILTRY, NUTSTD,NUTSTP,JUTSTC
      INTEGER IUCNTR,LTOPAS,LOUTOF,IUSAV
      INTEGER ICHAN1,NXTCHN,KILCHN,ICHANU,HTUCHN,CLNCHN
      INTEGER NCHANM,JCHAIN
      INTEGER NLASSF,LAYSSF,LAYSF, MAPSSF,WIRSSF,LADSSF,MADSSF
      INTEGER NEDCLR,AJUSOK,AFT_USED_OK,AFT_N_ISO_S_OK,MINLCH
      INTEGER WIDAD0,WIDAD1,WIDAD2,LENCA1,LENCA0,GAPWD1,GAPWD2
      INTEGER MDOUBH,MNOTIS
      INTEGER XXRPWL,XXRPWN
      INTEGER N_ST_THR_DEF,THRS_USE_PNT,THRS_ST_MEAS
      INTEGER WID_AD_ST,WID_AD_ST_LM,SCAL_ST_SHFT
      INTEGER CCTRLO,CCTRHI,WSVADD,GAPFIM
      INTEGER V_CHANGE_LIM
      INTEGER ZTST_RMV_OUTER,ZTST_RMV_INNER,ZTST_RMV_IN_AX
      INTEGER ZTST_SEL_IN_AX,ZTST_SEL_VALID
      INTEGER ZTST_ESC_ZWIND,ZTST_ESC_CURLV,ZTST_ESC_LEN_C
      INTEGER ZTST_ESC_MM0,ZTST_ESC_MMWL,ZTST_ESC_MLS
      INTEGER RAW_TDC_L,RAW_TDC_H
      REAL    TIME_PS_L,TIME_PS_H
      REAL    DRIFT_EXTRA_LO,DRIFT_EXTRA_HI
      REAL    DRIFT_D_L,DRIFT_D_H
      REAL    PULS_HT_L,PULS_HT_H	

      INTEGER NMERG ,NXTMRG,I12SAV,UZSAV,DIFAMG,DIFALT
      INTEGER VDIFSV,END2S, DELMHT
      INTEGER NSUPCH,NSUPCE,SUPCAD,SUPCLN,SUPCUS,SUPCEL

      INTEGER SFIND_ANALYZ,SFIND_ACKMERG,SFIND_ASFEFF
      INTEGER DSFHIT_KILLA
      INTEGER DSFRFV_KILALL,DSFRFV_KILL2
      INTEGER SFMERG_KILLA1,SFMERG_KILLA2,SFMERG_KILLA3
      INTEGER DSFCHV1_KILLA


      INTEGER SFChanList_Num
      INTEGER SFChanList_LastLoc
      INTEGER SFChanList_Iwindo
      INTEGER SFChanList_1stLoc
      INTEGER SFChanList_Length
      INTEGER SFChanList_ChnUse
      INTEGER SFChanList_KilChn
      INTEGER SFChanList_SFid

      COMMON/SFCM0I/CNTLSF,CNTLMG,FRSTST,LASTST,LASTFN,
     2              MXLSFU,MNLBSF,CHNEXT(2),
     3              SFZSLNWINDO,SFZSLWINDOL,SFZSLWINDOM
      COMMON/SFCM0L/LALTRD,LCLNSF(2)    ,LSFSVF,
     2              L_SF_DOIT_TPC
      COMMON/SFCM0R/SFZSLMAXDZ,SFZSLGRANU,SFZSLOVLAP,SFZSLOVRAD,
     2              SFZSLCNTR, SFZSLWID, SFZSLVEL
      COMMON/SFCMCONFIG/
     2              MLSFSV, MLSFPT, MLSFVD, MLSFZD, MLSFDR,
     3              MLSSFSV,MLSSFPT,MLSSFVD,MLSSFZD,MLSSFDR
      COMMON/SFCM1 /ICHAIN,NCHAIN,LINCHN  (MCHAIN),MINCHN(MCHAIN),
     2              LENCHN(MCHAIN),LVLCHN(2,MCHAIN),SNGCHN(MCHAIN)
      COMMON/SFZCM1/ZR0CHN(MCHAIN),ZDRCHN  (MCHAIN)
      COMMON/SFCM2 /ISTFOR(MHITSF),ISTBAK(MHITSF),INUCHN(MHITSF),
     1              DOUBPT(MHITSF),SFSPAR(MHITSF)

#if defined(CLEO_SFDIAG)
      COMMON/SFCM2E/INUEFF(MHITSF)
#endif

C ISTFBD...ISTFOR AND ISTBAK DUMMY ARRAY
C LMICHN...LINCHN AND MINCHN DUMMY ARRAY
      INTEGER        ISTFBD(MISTFB),LMICHN(MLMCHN)
      EQUIVALENCE    (ISTFOR,ISTFBD)
      EQUIVALENCE    (LINCHN,LMICHN)

      COMMON/SFCM3 /NLAYSF,
     2              INSFSF(MLAYSF),INCDSF(MLAYSF),
     3              CDLASF(MLAYSF),SFLACD(MCDLSF),
     4              SFLSFA(MHITSF),SFWSFA(MHITSF),
     5              OFFSF (MLAYSF),RADSF (MLAYSF),NWRSF(MLAYSF),
     6              OFFSSF(MLAYSF),RADSSF(MLAYSF),NWRSSF(MLAYSF),
     7              RPWSSF(MLAYSF)
      COMMON/SFZCM3/TANSSF(MLAYSF),ZNDSSF(MLAYSF)
      COMMON/SFCM4 /VSTORH,        VSTORS,        VSTORF,
     2              ISTORV,        VLLOC1,        VLLOC2,
     3              VLLOC3,        IVTEMP(2),
     4              EXTPV1,        EXTPV2,        EXTPDM,
     5              EXTUV1,        EXTUV2,        EXTUDM,
     6              EXTPRL,        EXTOLD,        EXTODM,
     7              RFX_N (3),     RFX_L (3),     RFX_S (6,MVSTOR),
     8              RFX_SS(3,2),   VELADD(MVSTOR)
      COMMON/SFZCM4/ZNCHN(MCHAIN),SFZMS1(MCHAIN),SFZMS2(MCHAIN),
     2              SFZMR(MSFZM,MCHAIN), SFZMZ(MSFZM,MCHAIN),
     3              SFZMD(MSFZM,MCHAIN), SFZML(MSFZM,MCHAIN)
      COMMON/SFZCM5/ZMESPT(MHITSF),PTZMES(MSFZM,MCHAIN)
      COMMON/SFCM5 /ILTRY,         NUTSTD,        NUTSTP,
     2              JUTSTC,        IUCNTR(MUTSTC),
     3              LTOPAS(MUTSTC,MSETUP),
     4              LOUTOF(MUTSTC,MSETUP),
     5              IUSAV(16)
      COMMON/SFCM6 /ICHAN1,        NXTCHN(MCHAIN),
     2              KILCHN(MKILCH,MCHAIN),
     3              ICHANU(MCHAIN),HTUCHN(MCHAIN),CLNCHN(MCHAIN)
      COMMON/SFCM7 /NCHANM,               JCHAIN(MCHANM)
      COMMON/SFCM8 /NLASSF,               LAYSSF(MLAYSF),
     2              LAYSF (MSFSSF,MLAYSF),
     3              MAPSSF(MHITSF),       WIRSSF(MHITSF),
     4              LADSSF(MLAYSF),       MADSSF(MLAYSF)

      COMMON/SFCT1 /
     1              RAW_TDC_L(MLAYSF),RAW_TDC_H(MLAYSF),
     2              TIME_PS_L(MLAYSF),TIME_PS_H(MLAYSF),
     3              DRIFT_EXTRA_LO,DRIFT_EXTRA_HI,
     4              DRIFT_D_L(MLAYSF),DRIFT_D_H(MLAYSF),
     5              PULS_HT_L(MLAYSF),PULS_HT_H(MLAYSF)

      COMMON/SFCM9 /
     1              NEDCLR(MSETUP),AJUSOK(MSETUP),
     2              AFT_USED_OK(MSETUP),AFT_N_ISO_S_OK(MSETUP),
     3              MINLCH(MSETUP),
     4              WIDAD0(MSETUP),WIDAD1(MSETUP),WIDAD2(MSETUP),
     5              LENCA1(MSETUP),LENCA0(MSETUP),
     6              GAPWD1(MSETUP),GAPWD2(MSETUP),
     7              MDOUBH(MSETUP),MNOTIS(MSETUP),
     8              XXRPWL(MSETUP),XXRPWN(MSETUP),
     9              N_ST_THR_DEF(MSETUP),
     x              THRS_USE_PNT(0:MSFZM,MSETUP),
     1              THRS_ST_MEAS(MSTDEF,MSETUP),
     2              WID_AD_ST(MSTDEF,MSETUP),
     3              WID_AD_ST_LM(MSTDEF,MSETUP),
     4              SCAL_ST_SHFT(MSTDEF,MSETUP),
     5              CCTRLO(MSETUP),CCTRHI(MSETUP),
     6              WSVADD(MSETUP),GAPFIM(MSETUP),
     7              V_CHANGE_LIM(MSETUP),
     8              ZTST_RMV_OUTER(MSETUP),ZTST_RMV_INNER(MSETUP),
     9              ZTST_RMV_IN_AX(MSETUP),
     x              ZTST_SEL_IN_AX(MSETUP),ZTST_SEL_VALID(MSETUP),
     1	            ZTST_ESC_ZWIND(MSETUP),
     2              ZTST_ESC_CURLV(MSETUP),ZTST_ESC_LEN_C(MSETUP),
     3              ZTST_ESC_MM0(MSETUP),
     4              ZTST_ESC_MMWL(MSETUP),ZTST_ESC_MLS(MSETUP)

      COMMON/SFECM1/NMERG,         NXTMRG(0:MMERG),
     2              I12SAV(2,MMERG),UZSAV(2,MMERG),
     3              DIFAMG(MMERG),   DIFALT(MMERG), VDIFSV(MMERG),
     4              END2S(MMERG),    DELMHT(MMERG)
      COMMON/SFECM2/NSUPCH,        NSUPCE,
     2              SUPCAD(MSUPCH),SUPCLN(MSUPCH),SUPCUS(MSUPCH),
     3              SUPCEL(MSUPCE)
      COMMON/SFDIAGSTOP/
     1              SFIND_ANALYZ,SFIND_ACKMERG,SFIND_ASFEFF,
     2              DSFHIT_KILLA,
     3              DSFRFV_KILALL,DSFRFV_KILL2,
     4              SFMERG_KILLA1,SFMERG_KILLA2,SFMERG_KILLA3,
     5              DSFCHV1_KILLA

      COMMON /SFCCHANLIST/
     1     SFChanList_Num,
     2     SFChanList_LastLoc,
     3     SFChanList_Iwindo(MCHANLIST),
     4     SFChanList_1stLoc(MCHANLIST),
     5     SFChanList_Length(MCHANLIST),
     6     SFChanList_ChnUse(MCHANLIST),
     7     SFChanList_KilChn(MKILCH,MCHANLIST),
     8     SFChanList_SFid(MHITSFLIST)

* ------------------------------------------









